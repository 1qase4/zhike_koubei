var gInit=true;$(".content").on("click",".switchLogin",function(a){a.preventDefault();$($(this).attr("href")).show().siblings("form").hide();if(gInit){securityCode1.init("codeBack");gInit=false}});$(function(){$("#slider").responsiveSlides({auto:true,pager:true,nav:false,speed:500,namespace:"callbacks"})});var securityCode={codeNum:null,init:function(b){var c=this;var a=document.getElementById(b);this.changeImg(a);a.onload=function(){c.getCode("/user/getSecurityCode")};$("#"+b).click(function(){c.changeImg(this);this.onload=function(){c.getCode("/user/getSecurityCode")}})},getCode:function(a){var b=this;$.get(a,function(c){b.codeNum=c})},changeImg:function(a){a.src="/user/getSecurity?"+Math.random()}};securityCode.init("codeFront");var securityCode1={codeNum:null,init:function(b){var c=this;var a=document.getElementById(b);this.changeImg(a);a.onload=function(){c.getCode("/user/getSecurityCode")};$("#"+b).click(function(){c.changeImg(this);this.onload=function(){c.getCode("/user/getSecurityCode")}})},getCode:function(a){var b=this;$.get(a,function(c){b.codeNum=c})},changeImg:function(a){a.src="/user/getSecurity?"+Math.random()}};document.onkeydown=function(b){var b=(b)?b:((window.event)?window.event:"");var a=b.keyCode?b.keyCode:b.which;if(a=="13"){$(".xsubmit").click()}};$("input").focus(function(){$(this).addClass("input-shadow");$(this).prev("span").children().css("color","#7DB0DD")});$("input").blur(function(){$(this).removeClass("input-shadow");$(this).prev("span").children().css("color","#ffffff")});function errorFocus(){$(".error-shadow").removeClass("error-shadow");$(this).addClass("error-shadow")}$(".xsubmit").click(function(){var i=this;var l=$(this).html();var a=$(this).parent().parent().attr("id");var k=$(this).parent().siblings(".cwts");var e=$(k).children(".errorTips");var g=$(this).parent().siblings(".uname").children("input[name='username']");var m=$(this).parent().siblings(".upwd").children("input[name='password']");var j=$(this).parent().siblings(".mycode").children("input[name='code']");var c=j.next(".code").attr("id");var d=$(this).parent().next().children(".switchLogin").attr("href")==="#back"?securityCode:securityCode1;k.hide();if(g.val()==""){k.show();g.focus(errorFocus).focus();e.html("请输入用户名!")}else{if(m.val()==""){k.show();m.focus(errorFocus).focus();e.html("请输入密码!")}else{if(j.val()==""){k.show();e.html("请输入验证码！");j.focus(errorFocus).focus()}else{if(j.val().toUpperCase()!=d.codeNum.toUpperCase()){k.show();e.html("验证码输入有误！");j.focus(errorFocus).focus();j.val("");var f=document.getElementById(c);d.changeImg(f)}else{var n=g.val();var b=$.md5(m.val());var h={username:n,password:b};if(a=="front"){$.ajax({type:"POST",url:"/user/dmpLogin",data:h,timeout:60000,beforeSend:function(o){$(i).html("登陆中...").prop("disabled",true)},success:function(o){if(!o.result){k.show();m.val("");j.val("");m.focus(errorFocus).focus();e.html("用户名和密码不匹配，请重新输入！");var p=document.getElementById("codeFront");securityCode.changeImg(p)}else{window.location.href="/front/shouye"}},complete:function(o,p){$(i).html(l).prop("disabled",false)}})}else{if(a=="back"){$.ajax({type:"POST",url:"/user/login",data:h,timeout:60000,beforeSend:function(o){$(i).html("登陆中...").prop("disabled",true)},success:function(p){if(p.result){window.location.href="/index/welcome"}else{k.show();m.val("");j.val("");m.focus(errorFocus).focus();e.html("用户名和密码不匹配，请重新输入！");var o=document.getElementById("codeBack");securityCode1.changeImg(o)}},complete:function(o,p){$(i).html(l).prop("disabled",false)}})}}}}}}});
