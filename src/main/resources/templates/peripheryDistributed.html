<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="renderer" content="webkit">
    <title>周边分布</title>
    <link href="/css/common.css" rel="stylesheet" type="text/css">
    <link href="/zui-1.7.0-dist/dist/css/zui.min.css" rel="stylesheet">
    <link href="/zui-1.7.0-dist/dist/lib/datetimepicker/datetimepicker.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="/iconfont/iconfont.css">
    <link rel="stylesheet" type="text/css" href="/css/peripheryDistributed.css">
</head>
<body>
<div class="child-container">
    <div class="title-box clearfix">
        <div class="common-title lf">客流分析-周边分布( <span id="currentTime"></span>)</div>
    </div>
    <!--图表区-->
    <div class="common-box">
        <div class="select-box clearfix">
            <div class="select-group">
                <label class="mylabel lf">选择时间</label>
                <div class="input-wrap lf">
                    <input type="text" id="month" class="form-control form-date-month" readonly="readonly" placeholder="选择月份">
                    <i class="icon icon-caret-down my-caret-down"></i>
                </div>
            </div>
        </div>
        <div class="chart-wrap">
            <div class="chart-title">单店客群分布热力图</div>
            <div id="charts" class="chart-common-wrap"></div>
        </div>
    </div>
</div>
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js" charset="UTF-8"></script>
<!--工具方法-->
<script src="/js/utils.js"></script>
<!-- ZUI 标准版压缩后的 JavaScript 文件 -->
<script src="/zui-1.7.0-dist/dist/js/zui.min.js"></script>
<script src="/zui-1.7.0-dist/dist/lib/datetimepicker/datetimepicker.min.js"></script>
<script src="https://cdn.bootcss.com/echarts/3.5.3/echarts.min.js"></script>
<script type="text/javascript" src="/js/bmap.min.js"></script>
<!--引入百度地图-->
<script src="https://api.map.baidu.com/api?v=2.0&ak=fwnkIfYEYf2QCGtTtqrqriqX8VszvUSK"></script>
<script src="https://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
<script>
    $(".form-date-month").datetimepicker({
        language:  "zh-CN",
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 3,//从月份开始选择
        minView: 3,//直接选择月
        forceParse: 0,
        format: "yyyy年mm月"
    });
    //    从父页面获取店名
    var gShop = parent.document.getElementById("shop").value;



    //选择时间时获取图
    $("#month").change(getCharts);
    //初始化
    $(function () {
//        if(window.localStorage && localStorage.getItem("peri-month")){
//            $("#month").val(localStorage.getItem("peri-month"));
//        }else{
        $("#month").val(getMonthByNow(0));
//        }
        getCharts();
    });
    function getCharts() {
        var time = $("#month").val();
        $.ajax({
//            url:"/media/points.json",//测试
            url:"/label/elevation",
            data:{account: gShop,time: time.replace(/\D/g,"-").slice(0,time.length-1)},
            type:'GET',
            timeout:60000,
            beforeSend:function(XMLHttpRequest){
                $(".loadingDiv").css('display','');
            },
            success:function(obj){
                $("#currentTime").html(time);
                //本地存储时间
                if(window.localStorage){
                    localStorage.setItem("peri-month",time);
                }
                //百度地图
//                var points =[
//                    {"lng":116.418261,"lat":39.921984,"count":50},
//                    {"lng":116.423332,"lat":39.916532,"count":51},
//                    {"lng":116.419787,"lat":39.930658,"count":15},
//                    {"lng":116.418455,"lat":39.920921,"count":40},
//                    {"lng":116.418843,"lat":39.915516,"count":100},
//                    {"lng":116.42546,"lat":39.918503,"count":6},
//                    {"lng":116.423289,"lat":39.919989,"count":18},
//                    {"lng":116.418162,"lat":39.915051,"count":80},
//                    {"lng":116.422039,"lat":39.91782,"count":11},
//                    {"lng":116.41387,"lat":39.917253,"count":7},
//                    {"lng":116.41773,"lat":39.919426,"count":42},
//                    {"lng":116.421107,"lat":39.916445,"count":4},
//                    {"lng":116.417521,"lat":39.917943,"count":27},
//                    {"lng":116.419812,"lat":39.920836,"count":23},
//                    {"lng":116.420682,"lat":39.91463,"count":60},
//                    {"lng":116.415424,"lat":39.924675,"count":8},
//                    {"lng":116.419242,"lat":39.914509,"count":15},
//                    {"lng":116.422766,"lat":39.921408,"count":25},
//                    {"lng":116.421674,"lat":39.924396,"count":21},
//                    {"lng":116.427268,"lat":39.92267,"count":1},
//                    {"lng":116.417721,"lat":39.920034,"count":51},
//                    {"lng":116.412456,"lat":39.92667,"count":7},
//                    {"lng":116.420432,"lat":39.919114,"count":11},
//                    {"lng":116.425013,"lat":39.921611,"count":35},
//                    {"lng":116.418733,"lat":39.931037,"count":22},
//                    {"lng":116.419336,"lat":39.931134,"count":4},
//                    {"lng":116.413557,"lat":39.923254,"count":5},
//                    {"lng":116.418367,"lat":39.92943,"count":3},
//                    {"lng":116.424312,"lat":39.919621,"count":100},
//                    {"lng":116.423874,"lat":39.919447,"count":87},
//                    {"lng":116.424225,"lat":39.923091,"count":32},
//                    {"lng":116.417801,"lat":39.921854,"count":44},
//                    {"lng":116.417129,"lat":39.928227,"count":21},
//                    {"lng":116.426426,"lat":39.922286,"count":80},
//                    {"lng":116.421597,"lat":39.91948,"count":32},
//                    {"lng":116.423895,"lat":39.920787,"count":26},
//                    {"lng":116.423563,"lat":39.921197,"count":17},
//                    {"lng":116.417982,"lat":39.922547,"count":17},
//                    {"lng":116.426126,"lat":39.921938,"count":25},
//                    {"lng":116.42326,"lat":39.915782,"count":100},
//                    {"lng":116.419239,"lat":39.916759,"count":39},
//                    {"lng":116.417185,"lat":39.929123,"count":11},
//                    {"lng":116.417237,"lat":39.927518,"count":9},
//                    {"lng":116.417784,"lat":39.915754,"count":47},
//                    {"lng":116.420193,"lat":39.917061,"count":52},
//                    {"lng":116.422735,"lat":39.915619,"count":100},
//                    {"lng":116.418495,"lat":39.915958,"count":46},
//                    {"lng":116.416292,"lat":39.931166,"count":9},
//                    {"lng":116.419916,"lat":39.924055,"count":8},
//                    {"lng":116.42189,"lat":39.921308,"count":11},
//                    {"lng":116.413765,"lat":39.929376,"count":3},
//                    {"lng":116.418232,"lat":39.920348,"count":50},
//                    {"lng":116.417554,"lat":39.930511,"count":15},
//                    {"lng":116.418568,"lat":39.918161,"count":23},
//                    {"lng":116.413461,"lat":39.926306,"count":3},
//                    {"lng":116.42232,"lat":39.92161,"count":13},
//                    {"lng":116.4174,"lat":39.928616,"count":6},
//                    {"lng":116.424679,"lat":39.915499,"count":21},
//                    {"lng":116.42171,"lat":39.915738,"count":29},
//                    {"lng":116.417836,"lat":39.916998,"count":99},
//                    {"lng":116.420755,"lat":39.928001,"count":10},
//                    {"lng":116.414077,"lat":39.930655,"count":14},
//                    {"lng":116.426092,"lat":39.922995,"count":16},
//                    {"lng":116.41535,"lat":39.931054,"count":15},
//                    {"lng":116.413022,"lat":39.921895,"count":13},
//                    {"lng":116.415551,"lat":39.913373,"count":17},
//                    {"lng":116.421191,"lat":39.926572,"count":1},
//                    {"lng":116.419612,"lat":39.917119,"count":9},
//                    {"lng":116.418237,"lat":39.921337,"count":54},
//                    {"lng":116.423776,"lat":39.921919,"count":26},
//                    {"lng":116.417694,"lat":39.92536,"count":17},
//                    {"lng":116.415377,"lat":39.914137,"count":19},
//                    {"lng":116.417434,"lat":39.914394,"count":43},
//                    {"lng":116.42588,"lat":39.922622,"count":27},
//                    {"lng":116.418345,"lat":39.919467,"count":8},
//                    {"lng":116.426883,"lat":39.917171,"count":3},
//                    {"lng":116.423877,"lat":39.916659,"count":34},
//                    {"lng":116.415712,"lat":39.915613,"count":14},
//                    {"lng":116.419869,"lat":39.931416,"count":12},
//                    {"lng":116.416956,"lat":39.925377,"count":11},
//                    {"lng":116.42066,"lat":39.925017,"count":38},
//                    {"lng":116.416244,"lat":39.920215,"count":91},
//                    {"lng":116.41929,"lat":39.915908,"count":54},
//                    {"lng":116.422116,"lat":39.919658,"count":21},
//                    {"lng":116.4183,"lat":39.925015,"count":15},
//                    {"lng":116.421969,"lat":39.913527,"count":3},
//                    {"lng":116.422936,"lat":39.921854,"count":24},
//                    {"lng":116.41905,"lat":39.929217,"count":12},
//                    {"lng":116.424579,"lat":39.914987,"count":57},
//                    {"lng":116.42076,"lat":39.915251,"count":70},
//                    {"lng":116.425867,"lat":39.918989,"count":8}];
                var points = obj.data.points;
                var map = new BMap.Map("charts");//创建实例
//                var point = new BMap.Point(116.418261, 39.921984);
                var point = new BMap.Point(obj.data.local[0], obj.data.local[1]);
                map.centerAndZoom(point,15);//初始化地图，设置中心点坐标和地图级别
                map.enableScrollWheelZoom(); // 允许滚轮缩放

                var marker = new BMap.Marker(point);//创建点
                var circle1 = new BMap.Circle(point,500,{fillColor : "transparent",fillOpacity : 0,strokeColor:"red",strokeWeight:2, strokeOpacity:0.5});
                var circle2 = new BMap.Circle(point,1000,{fillColor : "transparent",fillOpacity : 0,strokeColor:"green",strokeWeight:2, strokeOpacity:0.5});
                var circle3 = new BMap.Circle(point,1500,{fillColor : "transparent",fillOpacity : 0,strokeColor:"blue",strokeWeight:2, strokeOpacity:0.5});

                map.addOverlay(marker);
                map.addOverlay(circle1);
                map.addOverlay(circle2);
                map.addOverlay(circle3);

                //创建热力图
                heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
                map.addOverlay(heatmapOverlay);
                heatmapOverlay.setDataSet({data:points,max:100});
                heatmapOverlay.show();
                //    //    setGradient();
                //    function setGradient(){
                //        /*格式如下所示:
                //         {
                //         0:'rgb(102, 255, 0)',
                //         .5:'rgb(255, 170, 0)',
                //         1:'rgb(255, 0, 0)'
                //         }*/
                //        var gradient = {};
                //        var colors = document.querySelectorAll("input[type='color']");
                //        colors = [].slice.call(colors,0);
                //        colors.forEach(function(ele){
                //            gradient[ele.getAttribute("data-key")] = ele.value;
                //        });
                //        heatmapOverlay.setOptions({"gradient":gradient});
                //    }
            },
            error:function(XMLHttpRequest,textStatus,message){
                new $.zui.Messager(message || "错误", {
                    type: 'danger',
                    icon:'warning-sign',
                    time: 1000
                }).show();
            },
            complete:function(XMLHttpRequest,textStatus){
                $(".loadingDiv").css('display','none');
            }
        });
    }
//    var points = obj.data.coordinate.map(function (track) {
//        return track.coord.concat([2]);
//    });
//    var myChart = echarts.init(document.getElementById("charts"));
//    myChart.setOption(option = {
//        animation: false,
//        bmap: {
////                        center: [120.13066322374, 30.240018034923],
//            center: obj.data.local,
//            zoom: 14,
//            roam: true
//        },
//        visualMap: {
//            show: false,
////                        top: 'top',
//            min: 0,
//            max: 2,
//            seriesIndex: 0,
//            calculable: true,
//            inRange: {
//                color: ['blue', 'blue', 'green', 'yellow', 'red']
//            }
//        },
//        series: [{
//            type: 'heatmap',
//            coordinateSystem: 'bmap',
//            data: points,
//            pointSize: 5,
//            blurSize: 6
//        }]
//    });
//    var bmap = myChart.getModel().getComponent('bmap').getBMap();
//    var point = new BMap.Point(obj.data.local[0], obj.data.local[1]);
//    bmap.centerAndZoom(point, 15);
//    var marker = new BMap.Marker(point);
//    var circle1 = new BMap.Circle(point,300,{fillColor : "transparent",fillOpacity : 0,strokeColor:"red",strokeWeight:2, strokeOpacity:0.5});
//    var circle2 = new BMap.Circle(point,600,{fillColor : "transparent",fillOpacity : 0,strokeColor:"green",strokeWeight:2, strokeOpacity:0.5});
//    var circle3 = new BMap.Circle(point,900,{fillColor : "transparent",fillOpacity : 0,strokeColor:"blue",strokeWeight:2, strokeOpacity:0.5});
//    bmap.addOverlay(marker);//添加点
//    bmap.addOverlay(circle1);//添加圆
//    bmap.addOverlay(circle2);//添加圆
//    bmap.addOverlay(circle3);//添加圆
//    //                bmap.addControl(new BMap.MapTypeControl());
</script>
</body>
</html>
